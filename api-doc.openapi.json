{"openapi":"3.0.1","info":{"title":"SUSTech-HPC-Monitor","description":"","version":"1.0.0"},"tags":[],"paths":{"/devices":{"post":{"summary":"添加设备","deprecated":false,"description":"添加服务器，BMC信息使用/target系列接口添加\n```json\n{\n  \"name\": \"mu02\", //hostname\n  \"position\": \"03号机柜\",\n  \"type\": \"SERVER\",\n  \"clusterId\": 1,\n  \"other\": {\n    \"ip\": \"172.16.2.17\", //校园网IP\n    \"manageIp\": \"192.168.147.36\", //管理网IP\n    \"publicIp\": null, //公网IP\n  }\n}\n```\n\n添加 空调/路由器/交换机\n```json\n{\n  \"name\": \"空调03号\",\n  \"position\": \"太乙集群机房\",\n  \"type\": \"AIR_CONDITIONER\",\n  \"clusterId\": 1,\n  \"other\": null\n}\n```\n\n","tags":[],"parameters":[],"requestBody":{"content":{"application/json":{"schema":{"properties":{"deviceName":{"type":"string","examples":["空调03号"]},"devicePosition":{"type":"string","examples":["太乙集群机房"]},"deviceType":{"type":"string","enum":["SERVER","AIR_CONDITIONER","SWITCH","ROUTER"]},"clusterId":{"type":"integer","enum":[1,2]}},"required":["deviceName","devicePosition","deviceType","clusterId"],"$ref":"#/components/schemas/%E8%AE%BE%E5%A4%87"}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"position":{"type":"string"},"type":{"type":"string"},"clusterId":{"type":"integer"},"other":{"type":"null"}},"required":["id","name","position","type","clusterId","other"]}},"required":["code","message","data"]},"examples":{"1":{"summary":"空调/路由器/交换机","value":{"code":200,"message":"OK","data":{"id":6,"name":"空调03号","position":"太乙集群机房","type":"AIR_CONDITIONER","clusterId":1,"other":null}}},"2":{"summary":"服务器","value":{"code":200,"message":"OK","data":{"id":10,"name":"mu02","position":"03号机柜","type":"SERVER","clusterId":1,"other":{"ip":"172.16.2.17","manageIp":"192.168.147.36","publicIp":null}}}}}}}}},"security":[]},"get":{"summary":"查询所有设备","deprecated":false,"description":"此接口返回的所有设备类型的设备专有字段`other`均为`null`，如果要查询某个设备专有字段`other`，请使用`GET /devices/{id}`","tags":[],"parameters":[],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"position":{"type":"string"},"type":{"type":"string"},"clusterId":{"type":"integer"}},"required":["id","name","position","type","clusterId"]}}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":[{"id":1,"name":"空调03号","position":"太乙集群","type":"AIR_CONDITIONER","clusterId":1,"other":null},{"id":2,"name":"路由器04号","position":"启明集群","type":"ROUTER","clusterId":2,"other":null},{"id":3,"name":"机器3","position":"5号机柜","type":"SERVER","clusterId":2,"other":null}]}}}}}}},"security":[]}},"/user/send-verify-code":{"post":{"summary":"发送验证码","deprecated":false,"description":"向邮箱`email`发送6位验证码，有效期2分钟","tags":[],"parameters":[{"name":"email","in":"query","description":"","required":true,"example":"12011619@mail.sustech.edu.cn","schema":{"type":"string","format":"email"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":null}}}}}},"x-200:email格式不正确":{"description":"email格式不正确","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"[email] must be a well-formed email address","data":null}}}}}}},"security":[]}},"/devices/assignees/get":{"get":{"summary":"查询设备责任人","deprecated":false,"description":"查询设备责任人，可以设置筛选条件只看某设备的责任人","tags":[],"parameters":[{"name":"device_id","in":"query","description":"","required":false,"schema":{"type":"integer"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/user/register":{"post":{"summary":"注册","deprecated":false,"description":"","tags":[],"parameters":[],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"email":{"type":"string","examples":["12011619@mail.sustech.edu.cn"],"format":"email"},"username":{"type":"string","examples":["Alice"]},"password":{"type":"string","minLength":8,"maxLength":20,"examples":["Es68v464ev8"],"format":"password"},"verifyCode":{"type":"string","minLength":6,"maxLength":6,"examples":["114514"],"description":"6位邮箱验证码"}},"required":["email","username","password","verifyCode"]}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"token":{"type":"string","description":"标识用户身份的JWT，需要前端保存，用于其他接口认证"},"id":{"type":"integer","title":"用户id"},"name":{"type":"string","title":"用户名"},"email":{"type":"string","title":"用户邮箱"}},"required":["token","id","name","email"]}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":{"token":"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIwNjI3ZmViMThiMDk0M2E5OWYzYWZhN2UyOGYzNDQ3NyIsInN1YiI6IjMiLCJpc3MiOiJocGMuc3VzdGVjaC5lZHUuY24iLCJpYXQiOjE3MTM1Mzc3NzQsImV4cCI6MTcxMzU0MTM3NH0.6IuSuV_I0smWSmUBW7PnAyvoFWvmXskF7kslePWkY_Q","id":3,"name":"Alice","email":"836200779@qq.com"}}}}}}},"x-200:邮箱已被注册":{"description":"邮箱已被注册","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"该邮箱已被注册","data":null}}}}}},"x-200:验证码错误":{"description":"验证码错误","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"验证码错误","data":null}}}}}},"x-200:验证码已过期":{"description":"验证码已过期","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"验证码已过期，请重新发送","data":null}}}}}},"x-200:参数格式错误":{"description":"参数格式错误","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"[password] 长度必须在8-20之间","data":null}}}}}}},"security":[]}},"/devices/{id}":{"patch":{"summary":"修改设备","deprecated":false,"description":"修改设备信息，包括other专有字段信息，但不包括BMC信息，BMC信息使用/target系列接口修改\n<br>\n修改服务器\n```json\nPATCH /devices/12\n{\n  \"name\": \"mu02\", //hostname\n  \"position\": \"03号机柜\",\n  \"type\": \"SERVER\",\n  \"clusterId\": 1,\n  \"other\": {\n    \"ip\": \"172.16.2.17\", //校园网IP\n    \"manageIp\": \"192.168.147.36\", //管理网IP\n    \"publicIp\": \"114.96.49.247\" //公网IP\n  }\n}\n```\n修改空调/路由器/交换机\n```json\nPATCH /devices/8\n{\n  \"name\": \"空调04号\",\n  \"position\": \"太乙集群\",\n  \"type\": \"AIR_CONDITIONER\",\n  \"clusterId\": 1,\n  \"other\": null\n}\n```\n","tags":[],"parameters":[{"name":"id","in":"path","description":"","required":true,"schema":{"type":"string"}}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string","examples":["空调03号"],"title":"设备名称"},"position":{"type":"string","examples":["太乙集群机房"],"title":"设备位置"},"type":{"type":"string","title":"设备类型","enum":["AIR_CONDITIONER","SERVER","SWITCH","ROUTER"]},"clusterId":{"type":"integer","enum":[1,2],"title":"集群ID"},"other":{"type":"object","properties":{},"title":"设备专有字段","nullable":true}},"required":["name","position","type","clusterId","other"]}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"id":{"type":"integer"},"deviceName":{"type":"string"},"devicePosition":{"type":"string"},"deviceType":{"type":"string"},"clusterId":{"type":"integer"}},"required":["id","deviceName","devicePosition","deviceType","clusterId"]}},"required":["code","message","data"]},"examples":{"1":{"summary":"服务器","value":{"code":200,"message":"OK","data":{"id":12,"name":"mu02","position":"03号机柜","type":"SERVER","clusterId":1,"other":{"ip":"172.16.2.19","manageIp":"192.168.146.37","publicIp":"114.96.49.247"}}}},"2":{"summary":"空调/路由器/交换机","value":{"code":200,"message":"OK","data":{"id":7,"name":"空调03号","position":"太乙集群","type":"AIR_CONDITIONER","clusterId":1}}}}}}}},"security":[]},"delete":{"summary":"删除设备","deprecated":false,"description":"","tags":[],"parameters":[{"name":"id","in":"path","description":"","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"null"}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":null}}}}}}},"security":[]},"get":{"summary":"查询设备","deprecated":false,"description":"根据id查询单个设备的详细信息，包括设备专有字段other以及服务器的BMC信息","tags":[],"parameters":[{"name":"id","in":"path","description":"","required":true,"schema":{"type":"integer"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"服务器","value":{"code":200,"message":"OK","data":{"id":11,"name":"mu03","position":"04号机柜","type":"SERVER","clusterId":1,"other":{"ip":"172.16.2.18","manageIp":"192.168.147.37","publicIp":"null","bmc":{"ip":"10.18.69.18","user":"admin","password":"Root@2024","port":"623"}}}}},"2":{"summary":"空调/路由器/交换机","value":{"code":200,"message":"OK","data":{"id":8,"name":"交换机1","position":"02机柜","type":"SWITCH","clusterId":2,"other":{}}}},"3":{"summary":"设备不存在","value":{"code":200,"message":"OK","data":null}}}}}}},"security":[]}},"/devices/assignees/add/{deviceId}":{"post":{"summary":"添加设备责任人","deprecated":false,"description":"给指定的设备添加责任人（可以为多个）","tags":[],"parameters":[{"name":"deviceId","in":"path","description":"","required":true,"schema":{"type":"integer"}}],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"type":"integer"}}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/user/login":{"post":{"summary":"登录","deprecated":false,"description":"","tags":[],"parameters":[],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"email":{"type":"string","examples":["example@gmail.com"],"format":"email"},"password":{"type":"string","minLength":8,"maxLength":20,"examples":["4e68sv4evR"],"format":"password"}},"required":["email","password"]}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"token":{"type":"string","description":"标识用户身份的JWT，需要前端保存，用于其他接口认证"},"id":{"type":"integer","title":"用户id"},"name":{"type":"string","title":"用户名"},"email":{"type":"string","title":"用户邮箱"}},"required":["token","id","name","email"]}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":{"token":"eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiIwNjI3ZmViMThiMDk0M2E5OWYzYWZhN2UyOGYzNDQ3NyIsInN1YiI6IjMiLCJpc3MiOiJocGMuc3VzdGVjaC5lZHUuY24iLCJpYXQiOjE3MTM1Mzc3NzQsImV4cCI6MTcxMzU0MTM3NH0.6IuSuV_I0smWSmUBW7PnAyvoFWvmXskF7kslePWkY_Q","id":3,"name":"Alice","email":"836200779@qq.com"}}}}}}},"x-200:密码错误":{"description":"密码错误","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"密码错误","data":null}}}}}},"x-200:用户不存在":{"description":"用户不存在","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"用户不存在，请先注册","data":null}}}}}}},"security":[]}},"/devices/assignees/delete/{deviceId}":{"post":{"summary":"删除设备责任人","deprecated":false,"description":"","tags":[],"parameters":[{"name":"deviceId","in":"path","description":"","required":true,"schema":{"type":"integer"}}],"requestBody":{"content":{"application/json":{"schema":{"type":"array","items":{"type":"integer"}}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/target":{"get":{"summary":"获得所有 target","deprecated":false,"description":"查询所有被监控的 hardware","tags":[],"parameters":[{"name":"job","in":"query","description":"筛选出特定的 job 对应的 hardware","required":false,"example":"ipmi_exporter","schema":{"type":"string"}}],"responses":{"200":{"description":"成功","content":{"*/*":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"成功示例","value":"[\n    {\n        \"hardwareInfo\": {\n            \"hardwareId\": 2,\n            \"ip\": \"11.11.3.101\",\n            \"name\": \"bmc2\",\n            \"type\": \"BMC\",\n            \"serverId\": 2\n        },\n        \"serverInfo\": {\n            \"manageIp\": \"0.0.0.2\",\n            \"ip\": \"0.0.0.2\",\n            \"publicIp\": \"0.0.0.2\",\n            \"id\": 2\n        },\n        \"clusterInfo\": {\n            \"name\": \"Qiming\",\n            \"id\": 2\n        },\n        \"prometheusTargetInfo\": {\n            \"jobName\": \"ipmi_exporter\",\n            \"scrapeTimeout\": \"10s\",\n            \"scrapeInterval\": \"10s\",\n            \"targetAddr\": \"11.11.3.101\"\n        },\n        \"deviceInfo\": {\n            \"name\": \"机器2\",\n            \"id\": 2,\n            \"clusterId\": 2,\n            \"type\": \"SERVER\"\n        }\n    },\n    {\n        \"hardwareInfo\": {\n            \"hardwareId\": 3,\n            \"ip\": \"11.11.3.102\",\n            \"name\": \"bmc3\",\n            \"type\": \"BMC\",\n            \"serverId\": 3\n        },\n        \"serverInfo\": {\n            \"manageIp\": \"0.0.0.3\",\n            \"ip\": \"0.0.0.3\",\n            \"publicIp\": \"0.0.0.3\",\n            \"id\": 3\n        },\n        \"clusterInfo\": {\n            \"name\": \"Qiming\",\n            \"id\": 2\n        },\n        \"prometheusTargetInfo\": {\n            \"jobName\": \"ipmi_exporter\",\n            \"scrapeTimeout\": \"10s\",\n            \"scrapeInterval\": \"10s\",\n            \"targetAddr\": \"11.11.3.102\"\n        },\n        \"deviceInfo\": {\n            \"name\": \"机器3\",\n            \"id\": 3,\n            \"clusterId\": 2,\n            \"type\": \"SERVER\"\n        }\n    },\n    {\n        \"hardwareInfo\": {\n            \"hardwareId\": 4,\n            \"ip\": \"11.11.3.103\",\n            \"name\": \"bmc4\",\n            \"type\": \"BMC\",\n            \"serverId\": 4\n        },\n        \"serverInfo\": {\n            \"manageIp\": \"0.0.0.4\",\n            \"ip\": \"0.0.0.4\",\n            \"publicIp\": \"0.0.0.4\",\n            \"id\": 4\n        },\n        \"clusterInfo\": {\n            \"name\": \"Taiyi\",\n            \"id\": 1\n        },\n        \"prometheusTargetInfo\": {\n            \"jobName\": \"ipmi_exporter\",\n            \"scrapeTimeout\": \"10s\",\n            \"scrapeInterval\": \"10s\",\n            \"targetAddr\": \"11.11.3.103\"\n        },\n        \"deviceInfo\": {\n            \"name\": \"机器4\",\n            \"id\": 4,\n            \"clusterId\": 1,\n            \"type\": \"SERVER\"\n        }\n    },\n    {\n        \"hardwareInfo\": {\n            \"hardwareId\": 5,\n            \"ip\": \"11.11.3.104\",\n            \"name\": \"bmc5\",\n            \"type\": \"BMC\",\n            \"serverId\": 5\n        },\n        \"serverInfo\": {\n            \"manageIp\": \"0.0.0.5\",\n            \"ip\": \"0.0.0.5\",\n            \"publicIp\": \"0.0.0.5\",\n            \"id\": 5\n        },\n        \"clusterInfo\": {\n            \"name\": \"Qiming\",\n            \"id\": 2\n        },\n        \"prometheusTargetInfo\": {\n            \"jobName\": \"ipmi_exporter\",\n            \"scrapeTimeout\": \"10s\",\n            \"scrapeInterval\": \"10s\",\n            \"targetAddr\": \"11.11.3.104\"\n        },\n        \"deviceInfo\": {\n            \"name\": \"机器5\",\n            \"id\": 5,\n            \"clusterId\": 2,\n            \"type\": \"SERVER\"\n        }\n    },\n    {\n        \"hardwareInfo\": {\n            \"hardwareId\": 1,\n            \"ip\": \"11.11.3.100\",\n            \"name\": \"bmc1\",\n            \"type\": \"BMC\",\n            \"serverId\": 1\n        },\n        \"serverInfo\": {\n            \"manageIp\": \"0.0.0.1\",\n            \"ip\": \"0.0.0.1\",\n            \"publicIp\": \"0.0.0.1\",\n            \"id\": 1\n        },\n        \"clusterInfo\": {\n            \"name\": \"Taiyi\",\n            \"id\": 1\n        },\n        \"prometheusTargetInfo\": {\n            \"jobName\": \"ipmi_exporter\",\n            \"scrapeTimeout\": \"10s\",\n            \"scrapeInterval\": \"10s\",\n            \"targetAddr\": \"11.11.3.100\"\n        },\n        \"deviceInfo\": {\n            \"name\": \"机器1\",\n            \"id\": 1,\n            \"clusterId\": 1,\n            \"type\": \"SERVER\"\n        }\n    }\n]"}}}}}},"security":[]},"post":{"summary":"添加 target","deprecated":false,"description":"添加一个 prometheus target","tags":[],"parameters":[],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"name":{"type":"string"},"ip":{"type":"string"},"type":{"type":"string"},"serverId":{"type":"integer"},"other":{"type":"object","properties":{}}},"required":["name","ip","type","serverId","other"]}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/user/all":{"get":{"summary":"查询所有用户信息","deprecated":false,"description":"获取所有脱敏后的用户信息","tags":[],"parameters":[{"name":"user_id","in":"query","description":"","required":false,"schema":{"type":"integer"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"array","items":{"type":"object","properties":{"id":{"type":"integer"},"username":{"type":"string"},"email":{"type":"string"}},"required":["id","username","email"]}}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":[{"id":1,"username":"WLQ","email":"12011619@mail.sustech.edu.cn"},{"id":4,"username":"blackwang8","email":"1580716052@qq.com"},{"id":5,"username":"QQWLQ","email":"836200779@qq.com"}]}}}}}}},"security":[]}},"/alerts/all":{"get":{"summary":"查询所有告警","deprecated":false,"description":"查询所有的告警（包括手动添加的和 prometheus 检测的）。注意有 solveTime 和 solveMethod 的是已解决警告；没有的是未解决警告。对于 prometheus 告警，后续会开放接口根据 id 可查询额外信息（手动添加无）。","tags":[],"parameters":[{"name":"device_name","in":"query","description":"","required":false,"example":"空调03号","schema":{"type":"string"}},{"name":"start_time","in":"query","description":"","required":false,"example":"2024-05-29T14:10:28","schema":{"type":"string"}},{"name":"end_time","in":"query","description":"","required":false,"example":"2024-06-08T14:10:28","schema":{"type":"string"}},{"name":"solved","in":"query","description":"","required":false,"example":"True","schema":{"type":"boolean"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"string"}},"required":["code","message","data"]}}}}},"security":[]}},"/alerts/add":{"post":{"summary":"添加告警","deprecated":false,"description":"手动添加故障告警","tags":[],"parameters":[],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"description":{"type":"string","examples":["太乙集群机器mu02的路由器故障"]},"alertName":{"type":"string","nullable":true},"severity":{"type":"string"},"deviceName":{"type":"string"}},"required":["description","severity","deviceName"]},"example":""}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{},"required":["01HYVWM21251YMEW2X8ZC4X0QF"]}}}}},"security":[]}},"/target/{id}":{"post":{"summary":"删除 target","deprecated":false,"description":"删除指定 id 的 prometheus target","tags":[],"parameters":[{"name":"id","in":"path","description":"","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/alerts/solve/{id}":{"post":{"summary":"解决告警","deprecated":false,"description":"手动解决告警","tags":[],"parameters":[{"name":"id","in":"path","description":"告警ID","required":true,"example":"3","schema":{"type":"integer"}},{"name":"solveMethod","in":"query","description":"解决方法","required":false,"schema":{"type":"string"}}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{}}}}},"responses":{"200":{"description":"告警不存在","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/devices/file":{"post":{"summary":"批量导入设备","deprecated":false,"description":"通过csv文件批量导入设备","tags":[],"parameters":[],"requestBody":{"content":{"multipart/form-data":{"schema":{"type":"object","properties":{"file":{"example":"file:///Users/lishuxin/Documents/SusTech Courses/2024.1/Group/devices.xls","type":"string","format":"binary"}}}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/alerts/{id}":{"get":{"summary":"查询告警","deprecated":false,"description":"查询告警信息","tags":[],"parameters":[{"name":"id","in":"path","description":"告警ID","required":true,"example":"3","schema":{"type":"integer"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"id":{"type":"integer"},"createTime":{"type":"string"},"description":{"type":"string"},"solveTime":{"type":"null"},"solveMethod":{"type":"null"},"dutyUser":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"email":{"type":"string"}},"required":["id","name","email"]},"device":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"position":{"type":"string"},"type":{"type":"string"},"clusterId":{"type":"integer"}},"required":["id","name","position","type","clusterId"]}},"required":["id","createTime","description","solveTime","solveMethod","dutyUser","device"]}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":{"id":7,"createTime":"2024-05-15 16:57:08","description":"太乙集群机器mu02的路由器故障","solveTime":null,"solveMethod":null,"dutyUser":{"id":1,"name":"王立全","email":"12011619@mail.sustech.edu.cn"},"device":{"id":3,"name":"路由器03号","position":"太乙集群","type":"ROUTER","clusterId":1}}}}}}}},"x-200:告警不存在":{"description":"告警不存在","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":null}}}}}}},"security":[]},"patch":{"summary":"修改告警","deprecated":false,"description":"修改手动添加的告警","tags":[],"parameters":[{"name":"id","in":"path","description":"告警ID","required":true,"example":"3","schema":{"type":"integer"}}],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"description":{"type":"string","examples":["太乙集群mu03机器交换机故障"]},"dutyUserId":{"type":"integer","title":"责任人ID","examples":[5]},"deviceId":{"type":"integer","title":"设备ID","examples":[2]},"solveMethod":{"type":"string","title":"解决方法","examples":["手动更换设备"]}},"required":["description","deviceId","dutyUserId","solveMethod"]}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{"code":{"type":"integer"},"message":{"type":"string"},"data":{"type":"object","properties":{"id":{"type":"integer"},"createTime":{"type":"string"},"description":{"type":"string"},"solveTime":{"type":"null"},"solveMethod":{"type":"null"},"dutyUser":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"email":{"type":"string"}},"required":["id","name","email"]},"device":{"type":"object","properties":{"id":{"type":"integer"},"name":{"type":"string"},"position":{"type":"string"},"type":{"type":"string"},"clusterId":{"type":"integer"}},"required":["id","name","position","type","clusterId"]}},"required":["id","createTime","description","solveTime","solveMethod","dutyUser","device"]}},"required":["code","message","data"]},"examples":{"1":{"summary":"示例","value":{"code":200,"message":"OK","data":{"id":7,"createTime":"2024-05-15 16:57:08","description":"太乙集群机器mu03交换机故障","solveTime":"2024-05-16 17:03:55","solveMethod":"手动更换设备","dutyUser":{"id":5,"name":"王立全","email":"12011619@mail.sustech.edu.cn"},"device":{"id":2,"name":"路由器03号","position":"太乙集群","type":"ROUTER","clusterId":1}}}}}}}},"x-200:告警不存在":{"description":"告警不存在","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"告警ID不存在","data":null}}}}}},"x-200:责任人不存在":{"description":"责任人不存在","content":{"application/json":{"schema":{"type":"object","properties":{}},"examples":{"1":{"summary":"示例","value":{"code":400,"message":"责任人ID不存在","data":null}}}}}}},"security":[]}},"/alerts/rules":{"get":{"summary":"查询所有告警规则","deprecated":false,"description":"查询所有在 prometheus 中配置了的告警规则","tags":[],"parameters":[],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/alerts/rules/metric_filters":{"get":{"summary":"获得硬件metric对应告警规则可选过滤条件","deprecated":false,"description":"添加告警规则时，指定硬件类型和 metric 名称，提供可能的 filter 类型及可选值列表（均可不选）。","tags":[],"parameters":[{"name":"type","in":"query","description":"","required":false,"example":"BMC","schema":{"type":"string"}},{"name":"metric","in":"query","description":"","required":false,"example":"ipmi_temperature_celsius","schema":{"type":"string"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/alerts/rules/metric_names":{"get":{"summary":"获得硬件所有可选设置告警的 metric_name","deprecated":false,"description":"获得硬件所有可选设置告警的 metric_name。","tags":[],"parameters":[{"name":"type","in":"query","description":"","required":false,"example":"BMC","schema":{"type":"string"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/alerts/rules/delete":{"post":{"summary":"删除告警规则","deprecated":false,"description":"删除告警规则","tags":[],"parameters":[{"name":"type","in":"query","description":"","required":false,"schema":{"type":"string"}},{"name":"alert_name","in":"query","description":"","required":false,"schema":{"type":"string"}}],"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}},"/alerts/rules/add":{"post":{"summary":"添加告警规则","deprecated":false,"description":"添加告警规则\n```json\n{\n  \"type\": \"BMC\", // 硬件类型\n  \"alertName\": \"HighCPUTemp\", // 告警名字\n  \"metricName\": \"ipmi_temperature_celsius\", // 选择设置告警的 metric 名字，可以通过接口提供硬件类型查询可选项\n  \"expr\": \"> 51\", // 提供一个类似字符串，= x, > y 这样均可。保留中间的空格\n  \"severity\": \"LOW\", // 告警严重程度，目前有 NOTE, LOW, HIGH, CRITICAL四类\n  \"timeDuration\": \"5m\", // 设置的条件持续多长时间触发警告，非必须项（未设置则只要出现情况就视为告警。规则参考 https://prometheus.io/docs/prometheus/latest/querying/basics/ 中 time duration 部分）\n  \"description\": \"CPU temperature is too high\", // 有关告警的说明\n  \"filters\": {\n    \"name\": \"CPU_Temp\"\n  } // 对于每个不同的 metric 名字，有不同的 filter 可以选择。 通过提供硬件类型 + metric 名字可以获得 filter 列表，内容可以理解为一个 string -> list 的 map。每个 key 是一个 filter(如 name)，而这个 key 下面的 list 则是这个 filter 对应的可选项 (如 name 的 list 中包含 CPU_Temp。filter 都是非必须的，用户可以选择忽略)\n}\n```","tags":[],"parameters":[],"requestBody":{"content":{"application/json":{"schema":{"type":"object","properties":{"type":{"type":"string"},"alertName":{"type":"string"},"metricName":{"type":"string"},"timeDuration":{"type":"string"},"expr":{"type":"string"},"severity":{"type":"string"},"description":{"type":"string"},"filters":{"type":"object","properties":{}}},"required":["type","metricName","expr","severity","description","filters","alertName"]}}}},"responses":{"200":{"description":"成功","content":{"application/json":{"schema":{"type":"object","properties":{}}}}}},"security":[]}}},"components":{"schemas":{"设备":{"type":"object","properties":{"name":{"type":"string","examples":["空调03号"],"title":"设备名称"},"position":{"type":"string","examples":["太乙集群机房"],"title":"设备位置"},"type":{"type":"string","title":"设备类型","enum":["AIR_CONDITIONER","SERVER","SWITCH","ROUTER"]},"clusterId":{"type":"integer","enum":[1,2],"title":"集群ID"},"other":{"type":"object","properties":{},"title":"设备专有字段","nullable":true}},"required":["name","position","type","clusterId","other"]}},"securitySchemes":{}},"servers":[]}