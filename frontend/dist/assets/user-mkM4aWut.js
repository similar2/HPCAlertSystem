/* empty css             *//* empty css                   */import{_ as N}from"./pageContainer-C66w4MDG.js";/* empty css                  *//* empty css                   *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                      *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  */import{u as q,r as B,j as Q,o as n,c as d,a,aC as T,aD as P,aE as A,aF as j,aG as E,aH as D,e as m,K as c,f as w,b as i,G as R,L as y,H as _,I as C,J as v,d as Z,q as G,n as H,t as M,ag as O,ai as J,aj as K,p as W,ae as X,ac as Y,ak as x,aI as ee,ad as te}from"./index-CTSderqS.js";/* empty css                */const se={class:"container"},ae={class:"filter-container"},le=["textContent"],ie={class:"pagination-container"},re={class:"dialog-footer"},oe={data(){return{initEmail:"",rules:{name:[{required:!0,message:"请填写姓名",trigger:"blur"}],password:[{required:!0,trigger:"blur",validator:(s,t,r)=>{t===""?r(new Error("请输入初始密码")):/^(?=.{8,20}$)(?!.*\s).*$/.test(t)?r():r(new Error("密码长度须在 8 到 20 位之间，无空格"))}}],phone:[{required:!0,trigger:"blur",validator:(s,t,r)=>{t===""?r(new Error("请填写电话！")):t&&!/^1(3|4|5|6|7|8)\d{9}$/.test(t)?r(new Error("请输入正确的手机号！")):r()}}],email:[{required:!0,trigger:"blur",validator:(s,t,r)=>{t===""?r(new Error("请填写邮箱！")):/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(t)?T(t).then(o=>{o.data.code===200&&(o.data.data.email==null?r():o.data.data.email==t&&(this.dialogStatus==="update"&&this.initEmail===t&&r(),r(new Error("邮箱已被注册，请使用其他邮箱！"))),r())}):r(new Error("请输入正确的邮箱地址！"))}}]},totalCount:0,list:[],listLoading:!1,listQuery:{pageNum:1,pageSize:10},roles:[],dialogStatus:"create",dialogFormVisible:!1,textMap:{update:"编辑",create:"新建用户"},tempUser:{name:"",phone:"",email:"",password:"",name:"",roleIds:[],id:""}}},created(){this.getList(),this.getAllRoles()},methods:{getAllRoles(){P().then(s=>{this.roles=s.data.data})},getList(){this.listLoading=!0,A(this.listQuery).then(s=>{this.listLoading=!1,this.list=s.data.data.records,this.totalCount=s.data.data.total})},handleSizeChange(s){this.listQuery.pageSize=s,this.handleFilter()},handleCurrentChange(s){this.listQuery.pageNum=s,this.getList()},handleFilter(){this.listQuery.pageNum=1,this.getList()},getIndex(s){return(this.listQuery.pageNum-1)*this.listQuery.pageSize+s+1},showCreate(){this.tempUser.email="",this.tempUser.password="",this.tempUser.name="",this.tempUser.phone="",this.tempUser.roleIds=[],this.tempUser.id="",this.dialogStatus="create",this.dialogFormVisible=!0},showUpdate(s){let t=this.list[s];this.tempUser.email=t.email,this.initEmail=t.email,this.tempUser.name=t.name,this.tempUser.phone=t.phone,this.tempUser.roleIds=t.roles.map(r=>r.id),this.tempUser.id=t.id,this.tempUser.password="",this.dialogStatus="update",this.dialogFormVisible=!0},validate(s){let t=this.tempUser;if(s){if(s&&t.name.trim().length===0)return this.$message.warning("请填写姓名"),!1;if(s&&t.email.trim().length===0)return this.$message.warning("请填写邮箱"),!1;if(s&&t.phone.trim().length===0)return this.$message.warning("请填写电话"),!1;if(s&&t.password.length===0)return this.$message.warning("请填写密码"),!1}return s&&t.name.trim().length===0?(this.$message.warning("请填写姓名"),!1):s&&t.email.trim().length===0?(this.$message.warning("请填写邮箱"),!1):s&&t.phone.trim().length===0?(this.$message.warning("请填写电话"),!1):s&&t.password.length===0?(this.$message.warning("请填写密码"),!1):t.name.trim().length===0?(this.$message.warning("请填写姓名"),!1):t.roleIds.length===0?(this.$message.warning("请选择角色"),!1):!0},createUser(){this.validate(!0)&&(this.tempUser.deleted=0,j(this.tempUser).then(s=>{this.$message.success("添加成功"),this.getList(),this.dialogFormVisible=!1}))},updateUser(){this.validate(!1)&&E(this.tempUser).then(s=>{this.$message.success("修改成功"),this.getList(),this.dialogFormVisible=!1})},removeUser(s){this.$confirm("确定删除此用户?","提示",{confirmButtonText:"确定",showCancelButton:!1,type:"warning"}).then(()=>{D(this.list[s].id).then(t=>{this.$message.success("删除成功"),this.getList()}).catch(()=>{this.$message.error("删除失败")})})}}},ve=Object.assign(oe,{__name:"user",setup(s){const t=q(),r=B([]);return Q(t.user.value.id).then(e=>{console.log("permission by id : ",e.data.data),r.value=e.data.data,console.log("permissions: ",r.value)}).catch(e=>{console.error("获取权限失败: ",e)}),(e,o)=>{const g=G,u=H,V=M,p=O,b=ee,$=J,S=K,f=W,k=te,L=X,z=Y,F=N,I=x;return n(),d(F,{title:"用户列表"},{extra:a(()=>[r.value.includes("user:add")?(n(),d(g,{key:0,type:"success",onClick:e.showCreate},{default:a(()=>[m("添加用户")]),_:1},8,["onClick"])):c("",!0)]),default:a(()=>[w("div",se,[w("div",ae,[i(V,null,{default:a(()=>[i(u)]),_:1})]),R((n(),d($,{data:e.list,border:"",fit:"","highlight-current-row":""},{default:a(()=>[i(p,{align:"center",label:"序号",width:"80"},{default:a(({$index:l})=>[w("span",{textContent:y(e.getIndex(l))},null,8,le)]),_:1}),i(p,{align:"center",label:"姓名",prop:"name",width:"100px","show-overflow-tooltip":""}),i(p,{align:"center",label:"邮箱",prop:"email",width:"200px","show-overflow-tooltip":""}),i(p,{align:"center",label:"电话",prop:"phone",width:"130px","show-overflow-tooltip":""}),i(p,{align:"center",label:"角色"},{default:a(({row:l})=>[(n(!0),_(v,null,C(l.roles,(h,U)=>(n(),_("div",{style:{"margin-right":"4px",display:"inline-block"},key:U},[h.id===1?(n(),d(b,{key:0,type:"success"},{default:a(()=>[m(y(h.roleName),1)]),_:2},1024)):(n(),d(b,{key:1,type:"primary"},{default:a(()=>[m(y(h.roleName),1)]),_:2},1024))]))),128))]),_:1}),i(p,{align:"center",label:"创建时间",prop:"createTime",width:"180px","show-overflow-tooltip":""}),i(p,{align:"center",label:"最近修改时间",prop:"updateTime",width:"180px","show-overflow-tooltip":""}),i(p,{align:"center",label:"管理",width:"220",fixed:"right"},{default:a(({row:l,$index:h})=>[r.value.includes("user:update")?(n(),d(g,{key:0,type:"primary",onClick:U=>e.showUpdate(h)},{default:a(()=>[m("修改")]),_:2},1032,["onClick"])):c("",!0),l.id!==e.id&&r.value.includes("user:delete")?(n(),d(g,{key:1,type:"danger",onClick:U=>e.removeUser(h)},{default:a(()=>[m("删除")]),_:2},1032,["onClick"])):c("",!0)]),_:1})]),_:1},8,["data"])),[[I,e.listLoading]]),w("div",ie,[i(S,{class:"pageList",onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange,"current-page":e.listQuery.pageNum,"page-sizes":[10,20,30,40,50],"page-size":e.listQuery.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalCount},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),i(z,{title:e.textMap[e.dialogStatus],modelValue:e.dialogFormVisible,"onUpdate:modelValue":o[7]||(o[7]=l=>e.dialogFormVisible=l)},{footer:a(()=>[w("div",re,[i(g,{onClick:o[6]||(o[6]=l=>e.dialogFormVisible=!1)},{default:a(()=>[m("取 消")]),_:1}),e.dialogStatus==="create"?(n(),d(g,{key:0,type:"success",onClick:e.createUser},{default:a(()=>[m("创 建")]),_:1},8,["onClick"])):(n(),d(g,{key:1,type:"primary",onClick:Z(E)},{default:a(()=>[m("修 改")]),_:1},8,["onClick"]))])]),default:a(()=>[i(V,{class:"small-space",model:e.tempUser,rules:e.rules,"label-position":"left","label-width":"80px",style:{width:"300px","margin-left":"50px"}},{default:a(()=>[i(u,{label:"姓名",required:"",prop:"name"},{default:a(()=>[i(f,{type:"text",modelValue:e.tempUser.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.tempUser.name=l)},null,8,["modelValue"])]),_:1}),i(u,{label:"邮箱",required:"",prop:"email"},{default:a(()=>[i(f,{type:"text",modelValue:e.tempUser.email,"onUpdate:modelValue":o[1]||(o[1]=l=>e.tempUser.email=l)},null,8,["modelValue"])]),_:1}),i(u,{label:"电话",required:"",prop:"phone"},{default:a(()=>[i(f,{type:"text",modelValue:e.tempUser.phone,"onUpdate:modelValue":o[2]||(o[2]=l=>e.tempUser.phone=l)},null,8,["modelValue"])]),_:1}),e.dialogStatus==="create"?(n(),d(u,{key:0,label:"密码",required:"",prop:"password"},{default:a(()=>[i(f,{type:"password",modelValue:e.tempUser.password,"onUpdate:modelValue":o[3]||(o[3]=l=>e.tempUser.password=l)},null,8,["modelValue"])]),_:1})):(n(),d(u,{key:1,label:"新密码"},{default:a(()=>[i(f,{type:"password",modelValue:e.tempUser.password,"onUpdate:modelValue":o[4]||(o[4]=l=>e.tempUser.password=l),placeholder:"不填则表示不修改"},null,8,["modelValue"])]),_:1})),i(u,{label:"角色",required:""},{default:a(()=>[i(L,{modelValue:e.tempUser.roleIds,"onUpdate:modelValue":o[5]||(o[5]=l=>e.tempUser.roleIds=l),multiple:"",placeholder:"支持多角色",style:{width:"300px"}},{default:a(()=>[(n(!0),_(v,null,C(e.roles,l=>(n(),d(k,{key:l.id,label:l.roleName,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])]),_:1})}}});export{ve as default};
