/* empty css             *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                     */import{o as P}from"./Warning-D5QCuhAJ.js";import{i as E}from"./index-Dd36U2qk.js";import{r as i,B as G,o as h,H as _,f as c,b as u,a as D,c as $,K as z,ae as W,J as Y,I as j,ad as I}from"./index-CTSderqS.js";const N={style:{display:"flex","flex-direction":"column",gap:"20px",padding:"20px","background-color":"#f9f9f9"}},L=c("h2",{style:{margin:"0","font-size":"24px",color:"#333"}},"统计分析",-1),U={style:{display:"flex",gap:"20px"}},H={style:{width:"300px","background-color":"#fff",padding:"20px","border-radius":"8px","box-shadow":"0 2px 10px rgba(0, 0, 0, 0.1)"}},J=c("h3",{style:{"margin-top":"0","font-size":"18px"}},"选择统计维度",-1),K=c("p",{style:{color:"#666"}},"选择维度以查看对应数据",-1),R=c("div",{style:{flex:"1","background-color":"#fff",padding:"20px","border-radius":"8px","box-shadow":"0 2px 10px rgba(0, 0, 0, 0.1)"}},[c("div",{id:"statistics-chart",style:{width:"100%",height:"400px"}})],-1),ne={__name:"Statistics",setup(q){const s=i({weekly:[],monthly:[],byPerson:[],byType:[],byDevice:[]}),f=i(!1),y=i("weekly"),b=i(null),d=i(""),x=i([]),S=a=>{const t=new Set(a.map(o=>{const l=new Date(o.alertTime);return`${l.getFullYear()}-${l.getMonth()+1}`})),e=Array.from(t).sort();if(e.length<6){const o=new Date().getFullYear(),l=Array.from({length:12},(m,v)=>`${o}-${v+1}`),r=Math.max(0,l.indexOf(e[0])-2),n=Math.min(l.length-1,l.indexOf(e[e.length-1])+2);return l.slice(r,n+1)}return e},M=a=>{const t=new Set(a.map(e=>{const o=new Date(e.alertTime);return`${o.getFullYear()}-${o.getMonth()+1}`}));return Array.from(t).sort()},T=()=>{const a=document.getElementById("statistics-chart");b.value=E(a)},B=(a,t)=>{if(!b.value)return;const e={title:{text:t,left:"center",textStyle:{fontSize:16,fontWeight:"bold",color:"#333"}},tooltip:{trigger:"item"},xAxis:{type:"category",data:a.map(o=>o.label),axisLabel:{rotate:45,textStyle:{fontSize:12}}},yAxis:{type:"value",name:"数量",nameTextStyle:{fontSize:12}},grid:{left:"10%",right:"10%",bottom:"20%"},series:[{data:a.map(o=>o.value),type:"bar",barWidth:a.length>10?"20%":"50%",itemStyle:{color:"#409EFF",borderRadius:[5,5,0,0]}}]};b.value.setOption(e)},k=async()=>{f.value=!0;try{const t=(await P()).data.data,e=S(t);x.value=e,d.value=e[0]||"",s.value.weekly=V(t,M(t)),s.value.monthly=F(t,e),s.value.byPerson=A(t),s.value.byType=C(t),s.value.byDevice=O(t),g()}catch(a){console.error("获取统计数据失败:",a)}f.value=!1},F=(a,t)=>{const e=p(a,o=>{const l=new Date(o.alertTime);return`${l.getFullYear()}-${l.getMonth()+1}`});return t.map(o=>{var l;return{label:o,value:((l=e[o])==null?void 0:l.length)||0}})},V=(a,t)=>{const e=p(a,l=>{const r=new Date(l.alertTime),n=r.getFullYear(),m=r.getMonth()+1,v=new Date(n,m-1,1),w=Math.ceil(((r-v)/864e5+1)/7);return console.log("Alert:",l,"Grouped as:",`${n}-${m}-${w}`),`${n}-${m}-${w}`});return["第1周","第2周","第3周","第4周"].map((l,r)=>{var n;return{label:`${t}-${r+1}`,value:((n=e[`${t}-${r+1}`])==null?void 0:n.length)||0}})},A=a=>{const t=p(a,e=>e.responsiblePerson||"未分配");return Object.keys(t).map(e=>({label:e,value:t[e].length}))},C=a=>{const t=p(a,e=>e.description);return Object.keys(t).map(e=>({label:e,value:t[e].length}))},O=a=>{const t=p(a,e=>e.deviceId);return Object.keys(t).map(e=>({label:`设备 ${e}`,value:t[e].length}))},p=(a,t)=>a.reduce((e,o)=>{const l=t(o);return e[l]||(e[l]=[]),e[l].push(o),e},{}),g=()=>{let a=[],t="";switch(y.value){case"weekly":const e=s.value.weekly.filter(l=>l.label.startsWith(d.value));a=["第1周","第2周","第3周","第4周"].map((l,r)=>{var n;return{label:l,value:((n=e[r])==null?void 0:n.value)||0}}),t=`按周统计 (${d.value})`,console.log("Weekly data:",a);break;case"monthly":a=s.value.monthly,t="按月统计";break;case"byPerson":a=s.value.byPerson,t="按负责人统计";break;case"byType":a=s.value.byType,t="按类型统计";break;case"byDevice":a=s.value.byDevice,t="按设备统计";break}B(a,t)};return G(()=>{T(),k()}),(a,t)=>{const e=I,o=W;return h(),_("div",N,[c("header",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[L,c("button",{onClick:k,style:{padding:"10px 20px","background-color":"#409EFF",color:"#fff",border:"none","border-radius":"4px",cursor:"pointer"}}," 刷新数据 ")]),c("section",U,[c("aside",H,[J,u(o,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=l=>y.value=l),placeholder:"请选择统计维度",style:{width:"100%","margin-bottom":"20px"},onChange:g},{default:D(()=>[u(e,{label:"按周统计",value:"weekly"}),u(e,{label:"按月统计",value:"monthly"}),u(e,{label:"按负责人统计",value:"byPerson"}),u(e,{label:"按类型统计",value:"byType"}),u(e,{label:"按设备统计",value:"byDevice"})]),_:1},8,["modelValue"]),y.value==="weekly"?(h(),$(o,{key:0,modelValue:d.value,"onUpdate:modelValue":t[1]||(t[1]=l=>d.value=l),placeholder:"请选择月份",style:{width:"100%","margin-bottom":"20px"},onChange:g},{default:D(()=>[(h(!0),_(Y,null,j(x.value,l=>(h(),$(e,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):z("",!0),K]),R])])}}};export{ne as default};
