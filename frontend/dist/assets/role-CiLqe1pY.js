/* empty css             *//* empty css                   */import{_ as A}from"./pageContainer-C66w4MDG.js";/* empty css                  *//* empty css                   *//* empty css                    *//* empty css                 */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css               *//* empty css                *//* empty css                     *//* empty css                  */import{aJ as N,_ as M,aK as T,aL as j,C as z,D,o as r,c as p,a as l,G as b,e as _,f as h,b as a,L as k,H as u,I as y,J as C,K as O,q as G,n as J,t as K,ag as H,aI as Q,ai as W,p as X,ac as Y,ak as Z,aM as $,z as ee,A as te,N as se,v as le,aN as ie}from"./index-CTSderqS.js";import{g as oe}from"./permission-DR1YJoLX.js";/* empty css                */const re=e=>N.get("/api/user/rolePageQuery",{params:{roleName:e}}),ne=e=>N.post("/api/user/addRole",e),ae=e=>N.post("/api/user/updateRole",e),me=e=>N.post(`/api/user/deleteRole/${e}`),de={data(){return{list:[],allPermission:[],listLoading:!1,dialogStatus:"create",dialogFormVisible:!1,textMap:{update:"编辑",create:"新建角色"},tempRole:{roleName:"",roleId:"",permissions:[]},adminName:"管理员"}},components:{CircleClose:T},created(){this.getList(),this.getAllPermisson()},methods:{getAllPermisson(){oe().then(e=>{this.allPermission=e.data.data})},getList(){this.listLoading=!0,re("").then(e=>{this.listLoading=!1,this.list=e.data.data})},getIndex(e){return e+1},showCreate(){this.tempRole.roleName="",this.tempRole.roleId="",this.tempRole.permissions=[],this.dialogStatus="create",this.dialogFormVisible=!0},showUpdate(e){let t=this.list[e];this.tempRole.roleName=t.roleName,this.tempRole.roleId=t.roleId,this.tempRole.permissions=[];for(let s=0;s<t.menus.length;s++){let o=t.menus[s].permissions;for(let i=0;i<o.length;i++)this.tempRole.permissions.push(o[i].permissionId)}this.dialogStatus="update",this.dialogFormVisible=!0},createRole(){this.checkRoleNameUnique()&&this.checkPermissionNum()&&ne(this.tempRole).then(()=>{this.$message({type:"success",message:"添加成功!"}),this.getList(),this.dialogFormVisible=!1})},updateRole(){this.checkRoleNameUnique(this.tempRole.roleId)&&this.checkPermissionNum()&&ae(this.tempRole).then(()=>{this.$message({type:"success",message:"修改成功!"}),this.getList(),this.dialogFormVisible=!1})},checkPermissionNum(){return this.tempRole.permissions.length===0?(this.$message.error("请至少选择一种权限"),!1):!0},checkRoleNameUnique(e){let t=this.tempRole.roleName;if(!t)return this.$message.error("请填写角色名称"),!1;let s=this.list,o=!0;for(let i=0;i<s.length;i++)if(s[i].roleName===t&&(!e||s[i].roleId!==e)){this.$message.error("角色名称已存在"),o=!1;break}return o},removeRole(e,t){if(e.length>0){this.$message.error("该角色下有用户,请先将用户移出此角色");return}this.$confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{me(this.list[t].roleId).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.list.splice(t,1)})})},isMenuNone(e){let t=this.allPermission[e].permissions,s=!0;for(let o=0;o<t.length;o++)if(this.tempRole.permissions.indexOf(t[o].id)>-1){s=!1;break}return s},isMenuAll(e){let t=this.allPermission[e].permissions,s=!0;for(let o=0;o<t.length;o++)if(this.tempRole.permissions.indexOf(t[o].id)<0){s=!1;break}return s},checkAll(e){let t=this;t.isMenuAll(e)?t.noPerm(e):t.allPerm(e)},allPerm(e){let t=this.allPermission[e].permissions;for(let s=0;s<t.length;s++)this.addUnique(t[s].id,this.tempRole.permissions)},noPerm(e){let t=this.allPermission[e].permissions;for(let s=0;s<t.length;s++){let o=this.tempRole.permissions.indexOf(t[s].id);o>-1&&this.tempRole.permissions.splice(o,1)}},addUnique(e,t){t.indexOf(e)<0&&t.push(e)},checkRequired(e,t){let s=e.id;this.tempRole.permissions.indexOf(s)>-1?this.makeReuqiredPermissionChecked(t):e.requiredPerm===1&&this.noPerm(t)},makeReuqiredPermissionChecked(e){let t=this.allPermission[e].permissions;for(let s=0;s<t.length;s++){let o=t[s];o.requiredPerm===1&&this.addUnique(o.id,this.tempRole.permissions)}},removeUserFromRole(e,t,s,o){this.$confirm("此操作将删除该用户和此角色的对应关系, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{j(e,t).then(()=>{this.$message({type:"success",message:"删除成功!"}),this.list[o].users.splice(s,1)})})}}},ce=e=>(ee("data-v-82d03180"),e=e(),te(),e),pe={class:"container"},ue={class:"filter-container"},he=["textContent"],_e={style:{display:"inline-block","vertical-align":"middle"}},fe={key:1},ge={style:{width:"100px",display:"inline-block","text-align":"right"}},ke={key:0},Re={style:{width:"100px",display:"inline-block"}},ye={style:{display:"inline-block","margin-left":"20px"}},Ce=ce(()=>h("p",{style:{color:"#848484"}},"说明:红色权限为对应菜单内的必选权限",-1)),be={class:"dialog-footer"};function Ne(e,t,s,o,i,c){const f=G,x=J,P=K,R=H,V=z("CircleClose"),q=se,I=Q,w=W,L=X,U=le,F=ie,E=Y,B=A,v=D("permission"),S=Z;return r(),p(B,{title:"用户列表"},{extra:l(()=>[b((r(),p(f,{type:"success",onClick:c.showCreate},{default:l(()=>[_("添加角色")]),_:1},8,["onClick"])),[[v,"role:add"]])]),default:l(()=>[h("div",pe,[h("div",ue,[a(P,null,{default:l(()=>[a(x)]),_:1})]),b((r(),p(w,{data:i.list,border:"",fit:"","highlight-current-row":""},{default:l(()=>[a(R,{align:"center",label:"序号",width:"80"},{default:l(({$index:n})=>[h("span",{textContent:k(c.getIndex(n))},null,8,he)]),_:1}),a(R,{align:"center",label:"角色",prop:"roleName",width:"100"}),a(R,{align:"center",label:"用户"},{default:l(({row:n,$index:d})=>[(r(!0),u(C,null,y(n.users,(m,g)=>(r(),u("div",{key:g},[h("div",_e,[_(k(m.name)+" ",1),a(f,{type:"text",onClick:xe=>c.removeUserFromRole(n.roleId,m.userId,g,d)},{default:l(()=>[a(q,{size:e.size,color:e.color},{default:l(()=>[a(V)]),_:1},8,["size","color"])]),_:2},1032,["onClick"])])]))),128))]),_:1}),a(R,{align:"center",label:"菜单&权限",width:"400"},{default:l(({row:n})=>[n.roleName===i.adminName?(r(),p(I,{key:0,type:"success"},{default:l(()=>[_("全部")]),_:1})):(r(),u("div",fe,[(r(!0),u(C,null,y(n.menus,(d,m)=>(r(),u("div",{key:m,style:{"text-align":"left"}},[h("span",ge,k(d.menuName),1),(r(!0),u(C,null,y(d.permissions,g=>(r(),p(I,{key:g.permissionName,textContent:k(g.permissionName),style:{"margin-right":"3px"},type:"primary"},null,8,["textContent"]))),128))]))),128))]))]),_:1}),a(R,{align:"center",label:"管理",width:"220",fixed:"right"},{default:l(({row:n,$index:d})=>[n.roleName!=="管理员"?(r(),u("div",ke,[b((r(),p(f,{type:"primary",onClick:m=>c.showUpdate(d)},{default:l(()=>[_("修改")]),_:2},1032,["onClick"])),[[v,"role:update"]]),b((r(),p(f,{type:"danger",onClick:m=>c.removeRole(n.users,d)},{default:l(()=>[_(" 删除 ")]),_:2},1032,["onClick"])),[[v,"role:delete"]])])):O("",!0)]),_:1})]),_:1},8,["data"])),[[S,i.listLoading]]),a(E,{title:i.textMap[i.dialogStatus],modelValue:i.dialogFormVisible,"onUpdate:modelValue":t[3]||(t[3]=n=>i.dialogFormVisible=n)},{footer:l(()=>[h("div",be,[a(f,{onClick:t[2]||(t[2]=n=>i.dialogFormVisible=!1)},{default:l(()=>[_("取 消")]),_:1}),i.dialogStatus==="create"?(r(),p(f,{key:0,type:"success",onClick:c.createRole},{default:l(()=>[_("创 建")]),_:1},8,["onClick"])):(r(),p(f,{key:1,type:"primary",onClick:c.updateRole},{default:l(()=>[_("修 改")]),_:1},8,["onClick"]))])]),default:l(()=>[a(P,{class:"small-space",model:i.tempRole,"label-position":"left","label-width":"150px",style:{width:"600px","margin-left":"50px"}},{default:l(()=>[a(x,{label:"角色名称",required:""},{default:l(()=>[a(L,{type:"text",modelValue:i.tempRole.roleName,"onUpdate:modelValue":t[0]||(t[0]=n=>i.tempRole.roleName=n),style:{width:"250px"}},null,8,["modelValue"])]),_:1}),a(x,{label:"菜单&权限",required:""},{default:l(()=>[(r(!0),u(C,null,y(i.allPermission,(n,d)=>(r(),u("div",{key:n.menuName},[h("span",Re,[a(f,{type:c.isMenuNone(d)?"":c.isMenuAll(d)?"success":"primary",size:"mini",style:{width:"80px"},onClick:m=>c.checkAll(d)},{default:l(()=>[_(k(n.menuName),1)]),_:2},1032,["type","onClick"])]),h("div",ye,[a(F,{modelValue:i.tempRole.permissions,"onUpdate:modelValue":t[1]||(t[1]=m=>i.tempRole.permissions=m)},{default:l(()=>[(r(!0),u(C,null,y(n.permissions,m=>(r(),p(U,{label:m.id,onChange:g=>c.checkRequired(m,d),key:m.id},{default:l(()=>[h("span",{class:$({requiredPerm:m.requiredPerm===1})},k(m.permissionName),3)]),_:2},1032,["label","onChange"]))),128))]),_:2},1032,["modelValue"])])]))),128)),Ce]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])]),_:1})}const ze=M(de,[["render",Ne],["__scopeId","data-v-82d03180"]]);export{ze as default};
