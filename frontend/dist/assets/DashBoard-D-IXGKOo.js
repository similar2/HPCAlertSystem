/* empty css             */import{_ as ee,r as u,a5 as q,a6 as y,B as te,a7 as se,o as f,c as ae,a as b,b as Q,e as Z,f as t,H as T,G as m,a8 as v,K as z,a9 as oe,aa as ne,z as re,A as le,ab as ue}from"./index-CTSderqS.js";import{i as ie}from"./index-Dd36U2qk.js";import{_ as ce}from"./pageContainer-C66w4MDG.js";/* empty css                */const d=_=>(re("data-v-b5f9b5fb"),_=_(),le(),_),de={class:"chart-container"},pe=d(()=>t("div",{class:"chart-title"},"Cluster CPU Usage",-1)),me={ref:"cpuChart",class:"chart",id:"cpuChart"},ve={key:0,class:"settings-panel"},he={class:"settings-item"},_e=d(()=>t("label",null,"CPU Prometheus Query:",-1)),ge={class:"settings-item"},ye=d(()=>t("label",null,"Step (seconds):",-1)),fe={class:"chart-container"},be=d(()=>t("div",{class:"chart-title"},"Cluster GPU Usage",-1)),Ce={ref:"gpuChart",class:"chart",id:"gpuChart"},Ue={key:0,class:"settings-panel"},we={class:"settings-item"},xe=d(()=>t("label",null,"GPU Prometheus Query:",-1)),Se={class:"settings-item"},De=d(()=>t("label",null,"Step (seconds):",-1)),Pe={class:"chart-container"},$e=d(()=>t("div",{class:"chart-title"},"Logged-in Users",-1)),ke={ref:"userChart",class:"chart",id:"userChart"},Ee={key:0,class:"settings-panel"},Ie={class:"settings-item"},Ve=d(()=>t("label",null,"User Prometheus Query:",-1)),qe={class:"settings-item"},Qe=d(()=>t("label",null,"Step (seconds):",-1)),Te={__name:"DashBoard",setup(_){const p=u("taiyi"),C=q(null),U=y(()=>`(
    sum(
      (
        1 - (sum(irate(node_cpu_seconds_total{mode="idle", cluster="${p.value}"}[5m])) by (instance, cpu) /
             sum(irate(node_cpu_seconds_total{cluster="${p.value}"}[5m])) by (instance, cpu))
      )
    ) /
    sum(count(node_cpu_seconds_total{cluster="${p.value}", mode="idle"}) by (instance, cpu))
  ) * 100`),g=u(Math.floor(Date.now()/1e3)),B=u(g.value-24*3600),w=u(60),h=q(null),G=y(()=>`logged_in_users{cluster="${p.value}"}`),x=u(Math.floor(Date.now()/1e3)),L=u(x.value-24*3600),S=u(60),D=q(null),P=y(()=>`gpu_utilization_percentage{cluster="${p.value}"}`),M=u(Math.floor(Date.now()/1e3)),A=u(g.value-24*3600),$=u(60),J=y(()=>`logged_in_user_details{cluster="${p.value}"}`),k=u(!1),E=u(!1),I=u(!1),O=async(a,s="query_range",n={})=>{try{let e=`${ue()}:9090/api/v1/${s}?query=${encodeURIComponent(a)}`;for(const[r,c]of Object.entries(n))e+=`&${r}=${c}`;const l=await(await fetch(e)).json();return l.status==="success"?l.data.result:(console.error("Prometheus query failed:",l.error),[])}catch(o){return console.error("Error fetching data:",o),[]}},W=async(a,s,n,o)=>{const e=await O(a,"query_range",{start:s,end:n,step:o});if(e.length>0){const i={},l=[];for(let r=s;r<=n;r+=o){const c=new Date(r*1e3).toISOString();l.push(c),i[c]||(i[c]={timestamp:new Date(r*1e3),usernames:[],count:0})}return e[0].values.forEach(([r,c])=>{if(parseFloat(c)===1){const Y=e[0].metric.username,H=new Date(r*1e3).toISOString();i[H].usernames.push(Y),i[H].count+=1}}),l.map(r=>i[r]).sort((r,c)=>r.timestamp-c.timestamp)}else return console.warn("Query succeeded but returned no data."),[]},N=async(a,s,n,o)=>{const e=await O(a,"query_range",{start:s,end:n,step:o});return e.length>0?e[0].values.map(([i,l])=>({timestamp:new Date(i*1e3),value:parseFloat(l)})):(console.warn("Query succeeded but returned no data."),[])},V=(a,s,n,o)=>{const e=document.getElementById(s);if(!e)return;a.value&&a.value.dispose(),a.value=ie(e);const i={title:{text:n,left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},grid:{left:"10%",right:"10%",top:"15%",bottom:"20%"},xAxis:{type:"time",boundaryGap:!1,axisLabel:{formatter:"{yyyy}-{MM}-{dd} {hh}:{mm}"}},yAxis:{type:"value",axisLabel:{formatter:"{value}"}},series:[{name:n,type:"line",data:o.map(l=>[l.timestamp,l.value]),lineStyle:{width:2},showSymbol:!1,smooth:!0}],dataZoom:[{type:"slider",show:!0,xAxisIndex:0,start:0,end:100,bottom:"10%"},{type:"inside",xAxisIndex:[0],start:0,end:100}]};a.value.setOption(i)},R=async()=>{const a=await N(U.value,B.value,g.value,w.value);V(C,"cpuChart","CPU Usage (%)",a)},j=async()=>{const a=await W(J.value,L.value,x.value,S.value),s=a.map(o=>({timestamp:o.timestamp,value:o.count}));V(h,"userChart","Logged-in Users",s);const n=h.value.getOption();n.tooltip={trigger:"axis",axisPointer:{type:"cross"},formatter:o=>{var r;const[e,i]=o[0].data,l=((r=a.find(c=>c.timestamp===e))==null?void 0:r.usernames)||[];return console.log(e),`
        <strong>Time:</strong> ${new Date(e).toLocaleString()}<br/>
        <strong>User Count:</strong> ${i} Users<br/>
        <strong>Usernames:</strong> ${l.join(", ")}
      `}},h.value.setOption(n)},K=async()=>{const a=await N(P.value,A.value,M.value,$.value);V(D,"gpuChart","GPU Usage (%)",a)},F=()=>{R(),j(),K()},X=()=>{const a=Math.floor(Date.now()/1e3);g.value=a,B.value=a-24*3600,x.value=a,L.value=a-24*3600,M.value=a,A.value=a-24*3600};return te(()=>{X(),F()}),se(()=>{document.removeEventListener("resize",()=>{C.value&&C.value.resize(),h.value&&h.value.resize(),D.value&&D.value.resize()})}),(a,s)=>{const n=oe,o=ne;return f(),ae(ce,{title:"概览"},{default:b(()=>[Q(o,{modelValue:p.value,"onUpdate:modelValue":s[0]||(s[0]=e=>p.value=e),onChange:F,class:"radio-container"},{default:b(()=>[Q(n,{label:"taiyi"},{default:b(()=>[Z("taiyi")]),_:1}),Q(n,{label:"qiming"},{default:b(()=>[Z("qiming")]),_:1})]),_:1},8,["modelValue"]),t("div",de,[pe,t("div",me,null,512),t("div",{class:"settings-button",onClick:s[1]||(s[1]=e=>k.value=!k.value)}," ⋮ "),k.value?(f(),T("div",ve,[t("div",he,[_e,m(t("textarea",{"onUpdate:modelValue":s[2]||(s[2]=e=>U.value=e),placeholder:"Enter Prometheus query",rows:"2",style:{resize:"vertical"}},null,512),[[v,U.value]])]),t("div",ge,[ye,m(t("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=e=>w.value=e)},null,512),[[v,w.value,void 0,{number:!0}]])]),t("button",{onClick:R},"Update CPU Chart")])):z("",!0)]),t("div",fe,[be,t("div",Ce,null,512),t("div",{class:"settings-button",onClick:s[4]||(s[4]=e=>I.value=!I.value)}," ⋮ "),I.value?(f(),T("div",Ue,[t("div",we,[xe,m(t("textarea",{"onUpdate:modelValue":s[5]||(s[5]=e=>P.value=e),placeholder:"Enter Prometheus query",rows:"2",style:{resize:"vertical"}},null,512),[[v,P.value]])]),t("div",Se,[De,m(t("input",{type:"number","onUpdate:modelValue":s[6]||(s[6]=e=>$.value=e)},null,512),[[v,$.value,void 0,{number:!0}]])]),t("button",{onClick:K},"Update GPU Chart")])):z("",!0)]),t("div",Pe,[$e,t("div",ke,null,512),t("div",{class:"settings-button",onClick:s[7]||(s[7]=e=>E.value=!E.value)}," ⋮ "),E.value?(f(),T("div",Ee,[t("div",Ie,[Ve,m(t("textarea",{"onUpdate:modelValue":s[8]||(s[8]=e=>G.value=e),placeholder:"Enter Prometheus query",rows:"2",style:{resize:"vertical"}},null,512),[[v,G.value]])]),t("div",qe,[Qe,m(t("input",{type:"number","onUpdate:modelValue":s[9]||(s[9]=e=>S.value=e)},null,512),[[v,S.value,void 0,{number:!0}]])]),t("button",{onClick:j},"Update User Chart")])):z("",!0)])]),_:1})}}},Ae=ee(Te,[["__scopeId","data-v-b5f9b5fb"]]);export{Ae as default};
