/* empty css             *//* empty css                *//* empty css                  *//* empty css                   *//* empty css                      *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                    */import"./el-tooltip-l0sNRNKZ.js";/* empty css                     *//* empty css                  */import{c as H,i as J,j as W,k as Y,d as K,f as Q}from"./Warning-D5QCuhAJ.js";import{_ as X,r as m,aA as Z,B as ee,o as w,c as le,a as t,h as d,at as ae,f as h,b as e,e as c,H as x,I as T,J as S,L as te,M as oe,q as ne,p as re,n as se,ad as ue,ae as ie,t as de,ag as ce,aI as pe,ai as ve,aj as me,ac as fe,z as _e,A as ye}from"./index-CTSderqS.js";const ge=g=>(_e("data-v-0a5fead4"),g=g(),ye(),g),be={class:"header"},he=ge(()=>h("h2",{class:"header-title"},"设备管理",-1)),De={class:"header-buttons"},we={__name:"DeviceManagement",setup(g){const p=m([]);console.log("devices",p.value);const V=m(!1),N=o=>{n.value=o,y.value=!0,console.log("editDevice",n.value)},U=Z(),A=o=>{if(!o){console.error("Device ID is undefined. Check the binding in your table.");return}console.log("Navigating to alerts for deviceId:",o),U.push({path:"/article/auxiliary-monitoring/alert-management",query:{deviceId:o}})},u=m({deviceName:"",deviceType:null}),I=[{label:"电池",value:"BATTERY"},{label:"冷却系统",value:"AIR_CONDITIONER"},{label:"UPS",value:"UPS"}],n=m({name:"",type:"",position:"",status:"正常"}),y=m(!1),B=m(1),z=m(10),k=m(0),b=m(null),_=async()=>{V.value=!0;try{const o=await H();console.log("res",o.data.data);let a=o.data.data;u.value.deviceName&&(a=a.filter(s=>s.name.includes(u.value.deviceName))),u.value.deviceType&&(a=a.filter(s=>s.type===u.value.deviceType));const r=await Promise.all(a.map(async s=>{const i=(await J(s.id)).data.data;return console.log("deviceData",i),i.other=i.other||{},i.type!=="SERVER"?i:null}));p.value=r.filter(s=>s!==null),k.value=p.value.length,console.log("devices:  ",p.value)}catch(o){d.error("获取设备数据失败"),console.log("error",o)}V.value=!1},F=()=>{u.value.deviceName="",u.value.deviceType=null,_()},M=()=>{n.value={name:"",type:"",location:"",status:"正常",clusterId:""},y.value=!0,console.log("showDialog",n.value)},R=async o=>{try{if(o.other||(o.other={}),o.other.alert=o.status==="告警",!o.position||!o.clusterId){d.error("设备位置和集群 ID 不能为空");return}if(o.id){await W(o,o.id);const a=p.value.findIndex(r=>r.id===o.id);a!==-1&&(p.value[a]={...o}),p.value=[...p.value],d.success("设备更新成功")}else await Y(o),d.success("设备添加成功"),_();y.value=!1}catch{d.error("操作失败")}},$=async o=>{try{await oe.confirm("确认删除该设备吗？","提示",{type:"warning"}),await K(o),d.success("设备删除成功"),await _()}catch{d.error("删除失败")}},P=async()=>{const o=b.value.files[0];if(!o){d.error("请选择文件");return}try{await Q(o),d.success("设备导入成功"),_(),b.value.value=""}catch{d.error("设备导入失败")}};return ee(()=>{_()}),(o,a)=>{const r=ne,s=re,v=se,i=ue,D=ie,C=de,f=ce,O=pe,j=ve,q=me,G=fe,L=ae;return w(),le(L,{class:"main-card"},{default:t(()=>[h("div",be,[he,h("div",De,[e(r,{type:"primary",onClick:a[0]||(a[0]=l=>b.value.click())},{default:t(()=>[c(" 上传文件 ")]),_:1}),h("input",{ref_key:"fileInput",ref:b,type:"file",accept:".xlsx,.xls",style:{display:"none"},onChange:P},null,544),e(r,{type:"primary",onClick:M},{default:t(()=>[c(" 添加设备 ")]),_:1})])]),e(C,{inline:!0,model:u.value,class:"filter-form"},{default:t(()=>[e(v,{label:"设备名称"},{default:t(()=>[e(s,{modelValue:u.value.deviceName,"onUpdate:modelValue":a[1]||(a[1]=l=>u.value.deviceName=l),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),e(v,{label:"设备类型"},{default:t(()=>[e(D,{modelValue:u.value.deviceType,"onUpdate:modelValue":a[2]||(a[2]=l=>u.value.deviceType=l),placeholder:"请选择设备类型",style:{width:"120px"}},{default:t(()=>[(w(),x(S,null,T(I,l=>e(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(v,null,{default:t(()=>[e(r,{type:"primary",onClick:_},{default:t(()=>[c(" 搜索 ")]),_:1}),e(r,{onClick:F},{default:t(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"]),e(j,{data:p.value,border:"",style:{width:"100%"},class:"device-table"},{default:t(()=>[e(f,{prop:"id",label:"设备ID",width:"100"}),e(f,{prop:"name",label:"设备名称"}),e(f,{prop:"type",label:"设备类型"}),e(f,{prop:"position",label:"位置"}),e(f,{prop:"clusterId",label:"集群 ID"}),e(f,{prop:"other.alert",label:"告警状态"},{default:t(l=>[e(O,{type:l.row.other&&l.row.other.alert?"danger":"success"},{default:t(()=>[c(te(l.row.other&&l.row.other.alert?"告警":"正常"),1)]),_:2},1032,["type"])]),_:1}),e(f,{label:"操作",width:"180"},{default:t(l=>[e(r,{type:"text",size:"small",onClick:E=>N(l.row)},{default:t(()=>[c(" 编辑 ")]),_:2},1032,["onClick"]),e(r,{type:"text",size:"small",onClick:E=>$(l.row.id)},{default:t(()=>[c(" 删除 ")]),_:2},1032,["onClick"])]),_:1}),e(f,{label:"操作",width:"200",align:"center"},{default:t(l=>[e(r,{type:"text",size:"small",onClick:E=>A(l.row.id)},{default:t(()=>[c(" 查看告警 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e(q,{background:"",layout:"prev, pager, next",total:k.value,"current-page":B.value,"page-size":z.value,onCurrentChange:_},null,8,["total","current-page","page-size"]),e(G,{modelValue:y.value,"onUpdate:modelValue":a[10]||(a[10]=l=>y.value=l),title:"设备信息",width:"40%"},{footer:t(()=>[e(r,{onClick:a[8]||(a[8]=l=>y.value=!1)},{default:t(()=>[c("取消")]),_:1}),e(r,{type:"primary",onClick:a[9]||(a[9]=l=>R(n.value))},{default:t(()=>[c("保存")]),_:1})]),default:t(()=>[e(C,{model:n.value,"label-width":"100px"},{default:t(()=>[e(v,{label:"设备名称"},{default:t(()=>[e(s,{modelValue:n.value.name,"onUpdate:modelValue":a[3]||(a[3]=l=>n.value.name=l),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),e(v,{label:"设备类型"},{default:t(()=>[e(D,{modelValue:n.value.type,"onUpdate:modelValue":a[4]||(a[4]=l=>n.value.type=l),placeholder:"请选择设备类型"},{default:t(()=>[(w(),x(S,null,T(I,l=>e(i,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"设备位置"},{default:t(()=>[e(s,{modelValue:n.value.position,"onUpdate:modelValue":a[5]||(a[5]=l=>n.value.position=l),placeholder:"请输入设备位置"},null,8,["modelValue"])]),_:1}),e(v,{label:"设备状态"},{default:t(()=>[e(D,{modelValue:n.value.status,"onUpdate:modelValue":a[6]||(a[6]=l=>n.value.status=l),placeholder:"请选择设备状态"},{default:t(()=>[e(i,{label:"正常",value:"正常"}),e(i,{label:"告警",value:"告警"})]),_:1},8,["modelValue"])]),_:1}),e(v,{label:"集群 ID"},{default:t(()=>[e(s,{modelValue:n.value.clusterId,"onUpdate:modelValue":a[7]||(a[7]=l=>n.value.clusterId=l),placeholder:"请输入集群 ID"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),_:1})}}},Re=X(we,[["__scopeId","data-v-0a5fead4"]]);export{Re as default};
